{% extends "./partials/layout.njk" %}
{%- from "govuk/components/table/macro.njk" import govukTable -%}
{%- from "govuk/components/select/macro.njk" import govukSelect -%}
{%- from "moj/components/pagination/macro.njk" import mojPagination -%}
{%- from "govuk/components/button/macro.njk" import govukButton -%}
{%- from "govuk/components/tag/macro.njk" import govukTag -%}

{% set title =  "Search results" %}

 {% block beforeContent %}
   {{ govukBreadcrumbs({
     items: [
       { text: "Home", href: homeUrl },
       { text: "Manage user accounts", href: '/' },
       { text: searchTitle, href: searchUrl },
       { text: title}
     ]
   }) }}
 {% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <h1 class="govuk-heading-l">{{ title }}</h1>

    {% block searchFilter %}
      {% include "./partials/externalUserSearchFilter.njk" %}
    {% endblock %}

    {% if results.length %}
      {{ mojPagination(pagination) }}

      <div class="govuk-grid-row">
        {% set rows = [] %}
        {% for u in results %}
          {% set userLink %}
            <a href="{{ maintainUrl }}/{{ u.userId }}/details" class="govuk-link" data-qa="edit-button-{{ u.username }}">{{ u.firstName }}&nbsp;{{ u.lastName }}</a>
          {% endset %}
          {% set tags %}
            {{ govukTag({
              text: "Locked",
              classes: "govuk-tag--yellow"
            }) if u.locked }}
            {{ govukTag({
              text: "Inactive",
              classes: "govuk-tag--pink"
            }) if not u.enabled }}
            {{ govukTag({
              text: "Active",
              classes: "govuk-tag--green"
            }) if u.enabled }}
          {% endset %}
          {% set rows = (rows.push([
            { html: userLink },
            { text: u.usernameAndEmail },
            { html: tags }
          ]), rows) %}
        {% endfor %}

        {{ govukTable({
          head: [
            { text: "Name" },
            { text: "Username / email" },
            { text: "Status" }
          ],
          rows: rows
        }) }}
      </div>
      {{ mojPagination(pagination) }}
      {% if downloadUrl %}
        <div class="pull-right">
          <a href="{{ downloadUrl }}" class="govuk-link" data-qa="download" download="user-search.csv" type="text/csv">Download results</a>
        </div>
      {% endif %}
    {% else %}
      <p class="govuk-body" data-qa="no-results">No records found matching search criteria.</p>
    {% endif %}
  </div>
{% endblock %}
